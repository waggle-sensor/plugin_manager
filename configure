#!/bin/bash

set -x
set -e


# set node controller IP for "internal" network
if [ ! -e /etc/waggle/node_controller_host ] ; then
  echo "10.31.81.10" > /etc/waggle/node_controller_host
fi

if [ ! -e /etc/waggle/node_id ] ; then
 CRT_ND_SCR="/usr/lib/waggle/waggle_image/scripts/create_node_id.sh"
 if [ ! -e ${CRT_ND_SCR} ] ; then
   echo "node_id is missing and create_node_id.sh script was not found."
   echo "Please execute:"
   echo "  cd /usr/lib/waggle/ ; git clone https://github.com/waggle-sensor/waggle_image.git"
   exit 1
 fi

 source ${CRT_ND_SCR}
fi

# workaround  (fix later):
cp /etc/waggle/node_id /etc/waggle/hostname

#change this to offline install
./scripts/install_dependencies.sh

# daemons
mkdir -p /var/lof/waggle

ln -sf /usr/lib/waggle/plugin_manager/supervisor/waggle_plugin_manager.conf /etc/supervisor/conf.d/waggle_plugin_manager.conf

# TODO: with newer OS start using systemd
service supervisor restart


#ln -sf /usr/lib/waggle/plugin_manager/scripts/communicator.sh /etc/init.d/communicator.sh
#update-rc.d communicator.sh defaults 





